- name: Initial server setup
  hosts: all
  user: root
  vars_files: 
    - vars.yml
  tasks:
    - name: add user
      user: name=ds password="{{password}}" state=present groups=sudo shell=/bin/bash

    - name: enable password less sudo for users in sudo group
      lineinfile: "dest=/etc/sudoers state=present regexp='^%sudo' line='%sudo ALL=(ALL:ALL) NOPASSWD:ALL'"

    - name: Install apt packages
      apt: name="{{item}}"
      with_items: "{{apt_packages}}"

    - name: download anaconda3 installer
      get_url:
        url: https://repo.continuum.io/archive/Anaconda3-4.4.0-Linux-x86_64.sh
        dest: /tmp/Anaconda3-4.4.0-Linux-x86_64.sh

    - name: Install anaconda3
      command: bash /tmp/Anaconda3-4.4.0-Linux-x86_64.sh -b -p /usr/local/anaconda3
      args:
        creates: /usr/local/anaconda3

    - name: Install required python packages
      pip:
        name: "{{item}}"
        executable: /usr/local/anaconda3/bin/pip
      with_items: "{{python_packages}}"

    - name: add anaconda3 to path
      copy: src=files/anaconda.sh dest=/etc/profile.d